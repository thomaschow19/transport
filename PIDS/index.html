<!DOCTYPE html>
<html>
    <head>
        
        <meta name="apple-mobile-web-app-capable" content="yes">
            <meta name="mobile-web-app-capable" content="yes">
                <style>
                    @font-face {
                        font-family: myriadPro;
                        src: url(english.ttf);}
                    @font-face {
                        font-family: chinese;
                        src: url(chinese.otf);
                        unicode-range: U+4E00-9FFF;
                    }
                    
                    body {
                        font-family: chinese, myriadPro;
                        font-size:6vw;
                        height: 100%;
                        overflow: hidden;
                    }
                    
                    .vertical-center {
                        margin: 0;
                        position: absolute;
                        top: 50%;
                        -ms-transform: translateY(-50%);
                        transform: translateY(-50%);
                    }
                    [hidden] {
                        display: none !important;
                    }
                </style>
                
            </head>
    <body>
        <div id="settingsDIV">
            <h2>Next Train PIDS</h2>
            <select id="lineListDropdown" onchange = "lineChanged()" >
                
            </select>
            
            <select id="stationListDropdown" onchange = "stationChanged()" >
                
            </select>
            
            <select id="directionListDropdown" onchange = "directionChanged()" >
                
            </select>
            
            
            <button id="refreshButton" onclick="updatePage()" hidden>Reload Data from API</button>
            <button id="startPIDSButton" onclick="startPIDS()" hidden>Start PIDS</button>
            <button id="stopPIDSButton" onclick="stopPIDS()" hidden>Stop PIDS</button>
            <button id="LOHASExpressButton" onclick="LOHASExpress()">Start PIDS at LOHAS Park</button>
            <p id="lastRefreshedTimeLabel"></p>
            
            
            <p id="stationLabel"></p>
            
        </div>
        
        
        
        <div id="ETAContainerDIV" hidden>
            
            <div id="ETAchoosenDirectionDIV" style="height: 100vh;">
                <div id="ETAheaderContainer" style="background-color:#00387D; height:16%; display: flex;
  align-items: center;">
  <span id="ETAheader" style="color:#FFFFFF"></span>
  <div id="ETAheaderFloatRightContainer" style="margin-left: auto; margin-right: 2vw">
      <span id="currentTimeLabel" style="color:#FFFFFF; font-size:5vw">Time</span>
  </div>
                </div>
                <div id="ETA0Container" style="background-color:#FFFFFF; height:21%; display: flex;
  align-items: center;">
  <span id="ETA0destination" style="margin-left: 2vw"> Destination</span>
  <div id="ETA0floatRightContainer" style="margin-left: auto; margin-right: 2vw">
      <span id="ETA0platform" hidden> ETA0platform</span>
      <span id="ETA0time"> ETA</span>
  </div>
                </div>
                <div id="ETA1Container" style="background-color:#BDDBFF; height:21%; display: flex;
  align-items: center;">
  <span id="ETA1destination" style="margin-left: 2vw"> Destination</span>
  <div id="ETA1floatRightContainer" style="margin-left: auto; margin-right: 2vw">
      <span id="ETA1platform" hidden> ETA0platform</span>
      <span id="ETA1time"> ETA</span>
  </div>
                </div>
                <div id="ETA2Container" style="background-color:#FFFFFF; height:21%; display: flex;
  align-items: center;">
  <span id="ETA2destination" style="margin-left: 2vw"> Destination</span>
  <div id="ETA2floatRightContainer" style="margin-left: auto; margin-right: 2vw">
      <span id="ETA2platform" hidden> ETA0platform</span>
      <span id="ETA2time"> ETA</span>
  </div>
                </div>
                <div id="ETA3Container" style="background-color:#BDDBFF; height:21%; display: flex;
  align-items: center;">
  <span id="ETA3destination" style="margin-left: 2vw"> Destination</span>
  <div id="ETA3floatRightContainer" style="margin-left: auto; margin-right: 2vw">
      <span id="ETA3platform" hidden> ETA0platform</span>
      <span id="ETA3time"> ETA</span>
  </div>
                </div>
                <div id="ETA4Container" style="background-color:#FFFFFF; height:21%; display: flex;
  align-items: center;" hidden>
  <span id="ETA4destination" style="margin-left: 2vw"> Destination</span>
  <div id="ETA4floatRightContainer" style="margin-left: auto; margin-right: 2vw">
      <span id="ETA4platform" hidden> ETA1platform</span>
      <span id="ETA4time"> ETA</span>
  </div>
                </div>
                <div id="ETAStatusContainer" style="background-color:#BDDBFF; height:21%; display: flex;
  align-items: center;" hidden>
  <span id="ETAStatus" style="margin-left: 2vw">ETAStatusContainer</span>
                </div>
                
            </div>
        </div>
        
        
        
        <script>

            const directions = ["UP", "DOWN"];
            let intervalID;
            
            var jsonResponse;
            
            let stationList = {
                "TKL": {
                    "NOP": "North Point",
                    "QUB": "Quarry Bay",
                    "YAT": "Yau Tong",
                    "TIK": "Tiu Keng Leng",
                    "TKO": "Tseung Kwan O",
                    "LHP": "LOHAS Park",
                    "HAH": "Hang Hau",
                    "POA": "Po Lam"
                },
                "AEL": {
                    "HOK": "Hong Kong",
                    "KOW": "Kowloon",
                    "TSY": "Tsing Yi",
                    "AIR": "Airport",
                    "AWE": "AsiaWorld Expo"
                },
                "TCL": {
                    "HOK": "Hong Kong",
                    "KOW": "Kowloon",
                    "OLY": "Olympic",
                    "NAC": "Nam Cheong",
                    "LAK": "Lai King",
                    "TSY": "Tsing Yi",
                    "SUN": "Sunny Bay",
                    "TUC": "Tung Chung"
                },
                "EAL": {
                    "ADM": "Admiralty",
                    "EXC": "Exhibition Centre",
                    "HUH": "Hung Hom",
                    "MKK": "Mong Kok East",
                    "KOT": "Kowloon Tong",
                    "TAW": "Tai Wai",
                    "SHT": "Sha Tin",
                    "FOT": "Fo Tan",
                    "UNI": "University",
                    "TAP": "Tai Po Market",
                    "TWO": "Tai Wo",
                    "FAN": "Fanling",
                    "SHS": "Sheung Shui",
                    "LOW": "Lo Wu",
                    "LMC": "Lok Ma Chau"
                },
                "TML": {
                    "WKS": "Wu Kai Sha",
                    "MOS": "Ma On Shan",
                    "HEO": "Heng On",
                    "TSH": "Tai Shui Hang",
                    "SHM": "Shek Mun",
                    "CIO": "City One",
                    "STW": "Sha Tin Wai",
                    "CKT": "Che Kung Temple",
                    "TAW": "Tai Wai",
                    "HIK": "Hin Keng",
                    "DIH": "Diamond Hill",
                    "KAT": "Kai Tak",
                    "SUW": "Sung Wong Toi",
                    "TKW": "To Kwa Wan",
                    "HOM": "Ho Man Tin",
                    "HUH": "Hung Hom",
                    "ETS": "East Tsim Sha Tsui",
                    "AUS": "Austin",
                    "NAC": "Nam Cheong",
                    "MEF": "Mei Foo",
                    "TWW": "Tsuen Wan West",
                    "KSR": "Kam Sheung Road",
                    "YUL": "Yuen Long",
                    "LOP": "Long Ping",
                    "TIS": "Tin Shui Wai",
                    "SIH": "Siu Hong",
                    "TUM": "Tuen Mun"
                },
                "KTL": {
                    "WHA": "Whampoa",
                    "HOM": "Ho Man Tin",
                    "YMT": "Yau Ma Tei",
                    "MOK": "Mong Kok",
                    "PRE": "Prince Edward",
                    "SKM": "Shek Kip Mei",
                    "KOT": "Kowloon Tong",
                    "LOF": "Lok Fu",
                    "WTS": "Wong Tai Sin",
                    "DIH": "Diamond Hill",
                    "CHH": "Choi Hung",
                    "KOB": "Kowloon Bay",
                    "NTK": "Ngau Tau Kok",
                    "KWT": "Kwun Tong",
                    "LAT": "Lam Tin",
                    "YAT": "Yau Tong",
                    "TIK": "Tiu Keng Leng"
                },
                "ISL": {
                    "KET": "Kennedy Town",
                    "HKU": "HKU",
                    "SYP": "Sai Ying Pun",
                    "SHW": "Sheung Wan",
                    "CEN": "Central",
                    "ADM": "Admiralty",
                    "WAC": "Wan Chai",
                    "CAB": "Causeway Bay",
                    "TIH": "Tin Hau",
                    "FOH": "Fortress Hill",
                    "NOP": "North Point",
                    "QUB": "Quarry Bay",
                    "TAK": "Tai Koo",
                    "SWH": "Sai Wan Ho",
                    "SKW": "Shau Kei Wan",
                    "HFC": "Heng Fa Chuen",
                    "CHW": "Chai Wan"
                },
                "TWL": {
                    "CEN": "Central",
                    "ADM": "Admiralty",
                    "TST": "Tsim Sha Tsui",
                    "JOR": "Jordan",
                    "YMT": "Yau Ma Tei",
                    "MOK": "Mong Kok",
                    "PRE": "Prince Edward",
                    "SSP": "Sham Shui Po",
                    "CSW": "Cheung Sha Wan",
                    "LCK": "Lai Chi Kok",
                    "MEF": "Mei Foo",
                    "LAK": "Lai King",
                    "KWF": "Kwai Fong",
                    "KWH": "Kwai Hing",
                    "TWH": "Tai Wo Hau",
                    "TSW": "Tsuen Wan"
                },
                
                "SIL": {
                    "ADM": "Admiralty",
                    "OCP": "Ocean Park",
                    "WCH": "Wong Chuk Hang",
                    "LET": "Lei Tung",
                    "SOH": "South Horizons"
                    
                },
                
                "DRL": {
                    "DIS": "Disneyland Resort",
                    "SUN": "Sunny Bay"
                }
            }
            
            let newStationList = {
                "TKL": {
                    "NOP": {
                        "fullName_en": "North Point",
                        "fullName_ch": "北角"
                    },
                    "QUB": {
                        "fullName_en": "Quarry Bay",
                        "fullName_ch": "鰂魚涌"
                    },
                    "YAT": {
                        "fullName_en": "Yau Tong",
                        "fullName_ch": "油塘"
                    },
                    "TIK": {
                        "fullName_en": "Tiu Keng Leng",
                        "fullName_ch": "調景嶺"
                    },
                    "TKO": {
                        "fullName_en": "Tseung Kwan O",
                        "fullName_ch": "將軍澳"
                    },
                    "LHP": {
                        "fullName_en": "LOHAS Park",
                        "fullName_ch": "康城"
                    },
                    "HAH": {
                        "fullName_en": "Hang Hau",
                        "fullName_ch": "坑口"
                    },
                    "POA": {
                        "fullName_en": "Po Lam",
                        "fullName_ch": "寶琳"
                    },
                },
                "AEL": {
                    "HOK": {
                        "fullName_en": "Hong Kong",
                        "fullName_ch": ""
                    },
                    "KOW": {
                        "fullName_en": "Kowloon",
                        "fullName_ch": ""
                    },
                    "TSY": {
                        "fullName_en": "Tsing Yi",
                        "fullName_ch": ""
                    },
                    "AIR": {
                        "fullName_en": "Airport",
                        "fullName_ch": ""
                    },
                    "AWE": {
                        "fullName_en": "AsiaWorld Expo",
                        "fullName_ch": ""
                    },
                },
                "TCL": {
                    "HOK": {
                        "fullName_en": "Hong Kong",
                        "fullName_ch": ""
                    },
                    "KOW": {
                        "fullName_en": "Kowloon",
                        "fullName_ch": ""
                    },
                    "OLY": {
                        "fullName_en": "Olympic",
                        "fullName_ch": ""
                    },
                    "NAC": {
                        "fullName_en": "Nam Cheong",
                        "fullName_ch": ""
                    },
                    "LAK": {
                        "fullName_en": "Lai King",
                        "fullName_ch": ""
                    },
                    "TSY": {
                        "fullName_en": "Tsing Yi",
                        "fullName_ch": ""
                    },
                    "SUN": {
                        "fullName_en": "Sunny Bay",
                        "fullName_ch": ""
                    },
                    "TUC": {
                        "fullName_en": "Tung Chung",
                        "fullName_ch": ""
                    },
                },
                "EAL": {
                    "ADM": {
                        "fullName_en": "Admiralty",
                        "fullName_ch": ""
                    },
                    "EXC": {
                        "fullName_en": "Exhibition Centre",
                        "fullName_ch": ""
                    },
                    "HUH": {
                        "fullName_en": "Hung Hom",
                        "fullName_ch": ""
                    },
                    "MKK": {
                        "fullName_en": "Mong Kok East",
                        "fullName_ch": ""
                    },
                    "KOT": {
                        "fullName_en": "Kowloon Tong",
                        "fullName_ch": ""
                    },
                    "TAW": {
                        "fullName_en": "Tai Wai",
                        "fullName_ch": ""
                    },
                    "SHT": {
                        "fullName_en": "Sha Tin",
                        "fullName_ch": ""
                    },
                    "FOT": {
                        "fullName_en": "Fo Tan",
                        "fullName_ch": ""
                    },
                    "UNI": {
                        "fullName_en": "University",
                        "fullName_ch": ""
                    },
                    "TAP": {
                        "fullName_en": "Tai Po Market",
                        "fullName_ch": ""
                    },
                    "TWO": {
                        "fullName_en": "Tai Wo",
                        "fullName_ch": ""
                    },
                    "FAN": {
                        "fullName_en": "Fanling",
                        "fullName_ch": ""
                    },
                    "SHS": {
                        "fullName_en": "Sheung Shui",
                        "fullName_ch": ""
                    },
                    "LOW": {
                        "fullName_en": "Lo Wu",
                        "fullName_ch": ""
                    },
                    "LMC": {
                        "fullName_en": "Lok Ma Chau",
                        "fullName_ch": ""
                    },
                },
                "TML": {
                    "WKS": {
                        "fullName_en": "Wu Kai Sha",
                        "fullName_ch": ""
                    },
                    "MOS": {
                        "fullName_en": "Ma On Shan",
                        "fullName_ch": ""
                    },
                    "HEO": {
                        "fullName_en": "Heng On",
                        "fullName_ch": ""
                    },
                    "TSH": {
                        "fullName_en": "Tai Shui Hang",
                        "fullName_ch": ""
                    },
                    "SHM": {
                        "fullName_en": "Shek Mun",
                        "fullName_ch": ""
                    },
                    "CIO": {
                        "fullName_en": "City One",
                        "fullName_ch": ""
                    },
                    "STW": {
                        "fullName_en": "Sha Tin Wai",
                        "fullName_ch": ""
                    },
                    "CKT": {
                        "fullName_en": "Che Kung Temple",
                        "fullName_ch": ""
                    },
                    "TAW": {
                        "fullName_en": "Tai Wai",
                        "fullName_ch": ""
                    },
                    "HIK": {
                        "fullName_en": "Hin Keng",
                        "fullName_ch": ""
                    },
                    "DIH": {
                        "fullName_en": "Diamond Hill",
                        "fullName_ch": ""
                    },
                    "KAT": {
                        "fullName_en": "Kai Tak",
                        "fullName_ch": ""
                    },
                    "SUW": {
                        "fullName_en": "Sung Wong Toi",
                        "fullName_ch": ""
                    },
                    "TKW": {
                        "fullName_en": "To Kwa Wan",
                        "fullName_ch": ""
                    },
                    "HOM": {
                        "fullName_en": "Ho Man Tin",
                        "fullName_ch": ""
                    },
                    "HUH": {
                        "fullName_en": "Hung Hom",
                        "fullName_ch": ""
                    },
                    "ETS": {
                        "fullName_en": "East Tsim Sha Tsui",
                        "fullName_ch": ""
                    },
                    "AUS": {
                        "fullName_en": "Austin",
                        "fullName_ch": ""
                    },
                    "NAC": {
                        "fullName_en": "Nam Cheong",
                        "fullName_ch": ""
                    },
                    "MEF": {
                        "fullName_en": "Mei Foo",
                        "fullName_ch": ""
                    },
                    "TWW": {
                        "fullName_en": "Tsuen Wan West",
                        "fullName_ch": ""
                    },
                    "KSR": {
                        "fullName_en": "Kam Sheung Road",
                        "fullName_ch": ""
                    },
                    "YUL": {
                        "fullName_en": "Yuen Long",
                        "fullName_ch": ""
                    },
                    "LOP": {
                        "fullName_en": "Long Ping",
                        "fullName_ch": ""
                    },
                    "TIS": {
                        "fullName_en": "Tin Shui Wai",
                        "fullName_ch": ""
                    },
                    "SIH": {
                        "fullName_en": "Siu Hong",
                        "fullName_ch": ""
                    },
                    "TUM": {
                        "fullName_en": "Tuen Mun",
                        "fullName_ch": ""
                    },
                },
                "KTL": {
                    "WHA": {
                        "fullName_en": "Whampoa",
                        "fullName_ch": ""
                    },
                    "HOM": {
                        "fullName_en": "Ho Man Tin",
                        "fullName_ch": ""
                    },
                    "YMT": {
                        "fullName_en": "Yau Ma Tei",
                        "fullName_ch": ""
                    },
                    "MOK": {
                        "fullName_en": "Mong Kok",
                        "fullName_ch": ""
                    },
                    "PRE": {
                        "fullName_en": "Prince Edward",
                        "fullName_ch": ""
                    },
                    "SKM": {
                        "fullName_en": "Shek Kip Mei",
                        "fullName_ch": ""
                    },
                    "KOT": {
                        "fullName_en": "Kowloon Tong",
                        "fullName_ch": ""
                    },
                    "LOF": {
                        "fullName_en": "Lok Fu",
                        "fullName_ch": ""
                    },
                    "WTS": {
                        "fullName_en": "Wong Tai Sin",
                        "fullName_ch": ""
                    },
                    "DIH": {
                        "fullName_en": "Diamond Hill",
                        "fullName_ch": ""
                    },
                    "CHH": {
                        "fullName_en": "Choi Hung",
                        "fullName_ch": ""
                    },
                    "KOB": {
                        "fullName_en": "Kowloon Bay",
                        "fullName_ch": ""
                    },
                    "NTK": {
                        "fullName_en": "Ngau Tau Kok",
                        "fullName_ch": ""
                    },
                    "KWT": {
                        "fullName_en": "Kwun Tong",
                        "fullName_ch": ""
                    },
                    "LAT": {
                        "fullName_en": "Lam Tin",
                        "fullName_ch": ""
                    },
                    "YAT": {
                        "fullName_en": "Yau Tong",
                        "fullName_ch": ""
                    },
                    "TIK": {
                        "fullName_en": "Tiu Keng Leng",
                        "fullName_ch": ""
                    },
                },
                "ISL": {
                    "KET": {
                        "fullName_en": "Kennedy Town",
                        "fullName_ch": ""
                    },
                    "HKU": {
                        "fullName_en": "HKU",
                        "fullName_ch": ""
                    },
                    "SYP": {
                        "fullName_en": "Sai Ying Pun",
                        "fullName_ch": ""
                    },
                    "SHW": {
                        "fullName_en": "Sheung Wan",
                        "fullName_ch": ""
                    },
                    "CEN": {
                        "fullName_en": "Central",
                        "fullName_ch": ""
                    },
                    "ADM": {
                        "fullName_en": "Admiralty",
                        "fullName_ch": ""
                    },
                    "WAC": {
                        "fullName_en": "Wan Chai",
                        "fullName_ch": ""
                    },
                    "CAB": {
                        "fullName_en": "Causeway Bay",
                        "fullName_ch": ""
                    },
                    "TIH": {
                        "fullName_en": "Tin Hau",
                        "fullName_ch": ""
                    },
                    "FOH": {
                        "fullName_en": "Fortress Hill",
                        "fullName_ch": ""
                    },
                    "NOP": {
                        "fullName_en": "North Point",
                        "fullName_ch": ""
                    },
                    "QUB": {
                        "fullName_en": "Quarry Bay",
                        "fullName_ch": ""
                    },
                    "TAK": {
                        "fullName_en": "Tai Koo",
                        "fullName_ch": ""
                    },
                    "SWH": {
                        "fullName_en": "Sai Wan Ho",
                        "fullName_ch": ""
                    },
                    "SKW": {
                        "fullName_en": "Shau Kei Wan",
                        "fullName_ch": ""
                    },
                    "HFC": {
                        "fullName_en": "Heng Fa Chuen",
                        "fullName_ch": ""
                    },
                    "CHW": {
                        "fullName_en": "Chai Wan",
                        "fullName_ch": ""
                    },
                },
                "TWL": {
                    "CEN": {
                        "fullName_en": "Central",
                        "fullName_ch": ""
                    },
                    "ADM": {
                        "fullName_en": "Admiralty",
                        "fullName_ch": ""
                    },
                    "TST": {
                        "fullName_en": "Tsim Sha Tsui",
                        "fullName_ch": ""
                    },
                    "JOR": {
                        "fullName_en": "Jordan",
                        "fullName_ch": ""
                    },
                    "YMT": {
                        "fullName_en": "Yau Ma Tei",
                        "fullName_ch": ""
                    },
                    "MOK": {
                        "fullName_en": "Mong Kok",
                        "fullName_ch": ""
                    },
                    "PRE": {
                        "fullName_en": "Prince Edward",
                        "fullName_ch": ""
                    },
                    "SSP": {
                        "fullName_en": "Sham Shui Po",
                        "fullName_ch": ""
                    },
                    "CSW": {
                        "fullName_en": "Cheung Sha Wan",
                        "fullName_ch": ""
                    },
                    "LCK": {
                        "fullName_en": "Lai Chi Kok",
                        "fullName_ch": ""
                    },
                    "MEF": {
                        "fullName_en": "Mei Foo",
                        "fullName_ch": ""
                    },
                    "LAK": {
                        "fullName_en": "Lai King",
                        "fullName_ch": ""
                    },
                    "KWF": {
                        "fullName_en": "Kwai Fong",
                        "fullName_ch": ""
                    },
                    "KWH": {
                        "fullName_en": "Kwai Hing",
                        "fullName_ch": ""
                    },
                    "TWH": {
                        "fullName_en": "Tai Wo Hau",
                        "fullName_ch": ""
                    },
                    "TSW": {
                        "fullName_en": "Tsuen Wan",
                        "fullName_ch": ""
                    },
                },
                
                "SIL": {
                    "ADM": {
                        "fullName_en": "Admiralty",
                        "fullName_ch": ""
                    },
                    "OCP": {
                        "fullName_en": "Ocean Park",
                        "fullName_ch": ""
                    },
                    "WCH": {
                        "fullName_en": "Wong Chuk Hang",
                        "fullName_ch": ""
                    },
                    "LET": {
                        "fullName_en": "Lei Tung",
                        "fullName_ch": ""
                    },
                    "SOH": {
                        "fullName_en": "South Horizons",
                        "fullName_ch": ""
                    },
                    
                },
                
                "DRL": {
                    "DIS": {
                    "fullName_en": "Disneyland Resort",
                        "fullName_ch": ""
                    },
                    "SUN": {
                        "fullName_en": "Sunny Bay",
                        "fullName_ch": ""
                    },
                }
            }
            
            let lineList = {
                "KTL": {
                    "fullName": "Kwun Tong Line",
                    "enableETA": false,
                    "enableLOHAS": true,
                    "UP_dest": ["TIK"],
                    "DOWN_dest": ["WHA"]
                },
                "TWL": {
                    "fullName": "Tseun Wan Line",
                    "enableETA": false,
                    "enableLOHAS": false,
                    "UP_dest": ["TSW"],
                    "DOWN_dest": ["CEN"]
                },
                "ISL": {
                    "fullName": "Island Line",
                    "enableETA": false,
                    "enableLOHAS": false,
                    "UP_dest": ["CHW"],
                    "DOWN_dest": ["KET"]
                },
                "TKL": {
                    "fullName": "Tseung Kwan O Line",
                    "enableETA": true,
                    "enableLOHAS": true,
                    "UP_dest": ["POA", "LHP"],
                    "DOWN_dest": ["NOP"]
                },
                "SIL": {
                    "fullName": "South Island Line",
                    "enableETA": false,
                    "enableLOHAS": false,
                    "UP_dest": ["SOH"],
                    "DOWN_dest": ["ADM"]
                },
                "TCL": {
                    "fullName": "Tung Chung Line",
                    "enableETA": true,
                    "enableLOHAS": false,
                    "UP_dest": ["TUC"],
                    "DOWN_dest": ["HOK"]
                },
                "AEL": {
                    "fullName": "Airport Express",
                    "enableETA": true,
                    "enableLOHAS": false,
                    "UP_dest": ["AWE"],
                    "DOWN_dest": ["HOK"]
                },
                "DRL": {
                    "fullName": "Disneyland Resort Line",
                    "enableETA": false,
                    "enableLOHAS": false,
                    "UP_dest": ["SUN"],
                    "DOWN_dest": ["DIS"]
                },
                "EAL": {
                    "fullName": "East Rail Line",
                    "enableETA": true,
                    "enableLOHAS": false,
                    "UP_dest": ["LOW", "LMC"],
                    "DOWN_dest": ["ADM"]
                },
                "TML": {
                    "fullName": "Tuen Ma Line",
                    "enableETA": true,
                    "enableLOHAS": false,
                    "UP_dest": ["TUM"],
                    "DOWN_dest": ["WKS"]
                },
            }
            
            function updateStationLabel(line, station){
                let stationFullName = newStationList[line][station]["fullName_en"];
                let lineFullName = lineList[line]["fullName"];
                let text = "Showing information of <b>" + stationFullName + "</b> station on the " + lineFullName;
                let elementID = "stationLabel";
                document.getElementById(elementID).innerHTML = text
            }
            
            function startPIDS(){
                document.getElementById("startPIDSButton").hidden = true;
                document.getElementById("stopPIDSButton").hidden = false;
                document.getElementById("refreshButton").hidden = true;
                intervalID = setInterval(function(){ updatePage(); }, 100);
                document.getElementById("settingsDIV").hidden = true;
                document.getElementById("ETAContainerDIV").hidden = false;
            }
            
            function stopPIDS(){
                document.getElementById("stopPIDSButton").hidden = true;
                document.getElementById("startPIDSButton").hidden = false;
                document.getElementById("refreshButton").hidden = false;
                clearInterval(intervalID);
                document.getElementById("settingsDIV").hidden = false;
                document.getElementById("ETAContainerDIV").hidden = true;
            }
            
            function LOHASExpress(){
                document.getElementById("lineListDropdown").value = "TKL";
                lineChanged();
                document.getElementById("stationListDropdown").value = "LHP";
                stationChanged();
                document.getElementById("directionListDropdown").value = "DOWN";
                directionChanged();
                startPIDS();
            }
            
            
            
            function callAPI(line, station){
                var lineSta = line + '-' + station
                var request = 'line=' + line + '&sta=' + station
                var url = 'https://rt.data.gov.hk/v1/transport/mtr/getSchedule.php?' + request
                var Httpreq = new XMLHttpRequest(); // a new request
                Httpreq.open("GET",url,false);
                Httpreq.send(null);
                var response = Httpreq.responseText;

                var json_obj = JSON.parse(response);

                return json_obj;
                
            }
            
            
            
            function updateLabels(json, line, station, direction){
                var lineStation = line + '-' + station
                var dir = direction
                
                if(dir in json.data[lineStation]) {
                    document.getElementById("ETAStatusContainer").hidden = true;
                    
                    for (let i = 0; i < 5; i++) {
                        let elementIDdestination = "ETA" + i + "destination";
                        let elementIDplatform = "ETA" + i + "platform";
                        let elementIDtime = "ETA" + i + "time";
                        
                        if(i in json.data[lineStation][dir]){
                            
                            let ttnt = json.data[lineStation][dir][i]["ttnt"];
                            let dest = json.data[lineStation][dir][i]["dest"];
                            let plat = json.data[lineStation][dir][i]["plat"];
                            let destFullName = newStationList[line][dest]["fullName_en"];
                            let timeMessage = "";
                            if(ttnt < 1){
                                timeMessage = ""
                            } else if(ttnt == 1) {
                                timeMessage = ttnt + "<span style='font-size:3vw; margin-left: 1vw;'>min</span>"
                            } else {
                                timeMessage = ttnt + "<span style='font-size:3vw; margin-left: 1vw;'>mins</span>"
                            }
                            
                            document.getElementById(elementIDdestination).innerHTML = destFullName;
                            document.getElementById(elementIDplatform).innerHTML = plat;
                            document.getElementById(elementIDtime).innerHTML = timeMessage;
                            
                        } else {
                            document.getElementById(elementIDdestination).innerHTML = "";
                            document.getElementById(elementIDplatform).innerHTML = "";
                            document.getElementById(elementIDtime).innerHTML = "";
                            
                        }
                    }
                } else {
                    document.getElementById("ETAStatusContainer").hidden = false;
                    document.getElementById("ETAStatus").innerHTML = "Data not available";
                    
                }
                
                document.getElementById("lastRefreshedTimeLabel").innerHTML = json.curr_time;
                var date = new Date();
                var currentTime = date.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" });
                document.getElementById("currentTimeLabel").innerHTML = currentTime;
            }
            
            
            
            
            
            
            function updatePage(){
                var stationListDropdown = document.getElementById("stationListDropdown");
                
                let station = stationListDropdown.value;
                
                var lineListDropdown = document.getElementById("lineListDropdown");
                let line = lineListDropdown.value;
                var directionListDropdown = document.getElementById("directionListDropdown");
                let direction = directionListDropdown.value;
                updateStationLabel(line, station);
                updateLabels(callAPI(line, station), line, station, direction);
            }
            
            function lineChanged(){
                
                var lineListDropdown = document.getElementById("lineListDropdown");
                var line = lineListDropdown.value;

                
                
                
                updateStationDropdown(line);
                updateDirectionDropdown(line, "");
                
            }
            
            function stationChanged(){
                stopPIDS();
                var stationListDropdown = document.getElementById("stationListDropdown");
                
                let station = stationListDropdown.value;
                
                var lineListDropdown = document.getElementById("lineListDropdown");
                let line = lineListDropdown.value;
                if(line != '' && station != ''){
                    updatePage();
                    updateDirectionDropdown(line, station);
                }
                updateDirectionDropdown(line, station);
            }
            
            function directionChanged(){
                updatePage();
            }
            
            function updateLineDropdown(){
                
                var enabledLines = []
                for(const lineConcerned in lineList){
                    if(lineList[lineConcerned]["enableETA"] == true){
                        enabledLines.push(lineConcerned)
                    }
                }
                document.getElementById("lineListDropdown").innerHTML = "<option value='' disabled selected> --- Lines --- </option>"
                for (var lineID of enabledLines){
                    document.getElementById("lineListDropdown").innerHTML += "<option value='" + lineID + "'> " + lineList[lineID]["fullName"] + "</option>"
                }
            }
            
            
            function updateStationDropdown(line){
                document.getElementById("stationListDropdown").innerHTML = "<option value='' disabled selected> --- Stations --- </option>"
                
                if(line == ''){
                    
                    document.getElementById("stationListDropdown").innerHTML += "<option value='Placeholder' disabled > --- Stations will appear after a line is choosen --- </option>"
                } else {
                    var listOfStationsInSelectedLine = newStationList[line];
                    for (var staID in listOfStationsInSelectedLine){
                        
                        document.getElementById("stationListDropdown").innerHTML += "<option value='" + staID + "'> " + listOfStationsInSelectedLine[staID]["fullName_en"] + "</option>"
                    }
                }
            }
            
            function updateDirectionDropdown(line, station){
                document.getElementById("directionListDropdown").innerHTML = "<option value='' disabled selected> --- Direction --- </option>"
                if(line == ''){
                    document.getElementById("directionListDropdown").innerHTML += "<option value='Placeholder' disabled > --- Destinations will appear after a line and station is choosen --- </option>"
                    
                } else {
                    
                    for(var dir of directions){
                        let dirDest = dir + "_dest";
                        let destinations = lineList[line][dirDest];
                        var destFullNames = "";
                        for(const destConcerned of destinations){
                            
                            if(destFullNames == ""){

                                destFullNames += newStationList[line][destConcerned]["fullName_en"];
                            } else {

                                destFullNames += " / " + newStationList[line][destConcerned]["fullName_en"];
                            }
                            
                        }

                        document.getElementById("directionListDropdown").innerHTML += "<option value='" + dir + "'> To: " + destFullNames + "</option>"
                    }
                    
                    
                }
            }
            
            function processURLParameter(){
                const queryString = window.location.search;
                console.log({ queryString });
                const urlParams = new URLSearchParams(queryString);
                const LOHASExpress = urlParams.get('LOHAS');
                if(LOHASExpress=="true"){
                    LOHASExpress();
                }
            }
            
            
            
            
            
            
            
            updateLineDropdown();
            updateStationDropdown("");
            updateDirectionDropdown("", "")
            processURLParameter();
            
            
        </script>
        
    </body>
</html>
